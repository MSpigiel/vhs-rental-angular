<div class="container moviesList">

  <ul>
    <div class="container-fluid sortingButtonsContainer">
      <div>You can filter by <input placeholder="Title phrase" id="search" value="" [(ngModel)]="filterargs"></div>
      <div>
        <div style="float:left; width:300px; margin-right:85px;">And sort movies list by: </div>
        <div class = "sortingButton">
          <button type="button" class="btn btn-success btn-md sort" (click)="sortByTitle()">Title</button>
          <button type="button" class="btn btn-success btn-md sort" (click)="sortByDate()">Date</button>
          <button type="button" class="btn btn-success btn-md sort" (click)="sortByRating()">Rating</button>
        </div>
        <div style="clear:both;"></div>
      </div>
      <div style="text-align:center; margin-top:20px;"><button type="button" class="btn btn-danger btn-lg" data-toggle="modal" data-target="#addMovie">ADD MOVIE</button></div>

    </div>

    <div class="container-fluid singleMovie" *ngFor="let movie of movies | myfilter:filterargs" >
      <li>
        <div class="title">{{movie.title}}</div>
        <div class="year">{{movie.productionDate}}</div>
        <div class="rating">{{movie.rating}}</div>
        <button type="button" class="btn btn-primary btn-md details" (click)="onSelect(movie)" data-toggle="modal" data-target="#movieEdit">Edit</button>
        <button type="button" class="btn btn-primary btn-md details" (click)="onSelect(movie)" data-toggle="modal" data-target="#movieDetails">Details</button>
      </li>
    </div>

  </ul>
</div>

<div id="movieDetails" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">{{currentMovie.title}}</h2>
      </div>
      <div class="modal-body">
        <div [hidden]="submitted">
          <div class="movieDetails">
            <h4> Director:  {{currentMovie.director}}<br><br></h4>
            <h4> Genre:  {{currentMovie.genre}}<br><br></h4>
            <h4> Production country:  {{currentMovie.productionCountry}}<br><br></h4>
            <h4> Production year:  {{currentMovie.productionDate}}<br><br></h4>
            <h4> Duration:  {{currentMovie.duration}} minutes <br><br></h4>
            <h4> Rating:  {{currentMovie.rating}}<br><br></h4>
          </div>
          <div class="posterImg">
            <img src="{{currentMovie.posterUrl}}">
          </div>
          <div style="clear:both;"></div>
        </div>

        <div [hidden]="!edited">
          <form #rentForm="ngForm" (ngSubmit)="onSubmit()">

            Rent {{currentMovie.title}} to a person of <br>

            <div class="form-group">
              <label for="socialSecurity">Social-security number:</label>
              <input name="socialSecurity" type="text" autocomplete="off" minlength="9" maxlength="9" style="text-transform:uppercase" class="form-control inputMovie" id="socialSecurity" required [(ngModel)]="rental.socialSecurity" #socialSecurity="ngModel">
              <div *ngIf="socialSecurity.errors && (socialSecurity.dirty || socialSecurity.touched)" class="alert alert-danger inputMovie">
                <div [hidden]="!socialSecurity.errors.required">
                  9-characters social security number is required.
                </div>
                <div [hidden]="!socialSecurity.errors.minlength">
                  Social-security must contain 9 characters.
                </div>
              </div>
            </div>

            <div class="form-group">
              <label for="days">For an amount of days equals of:</label>
              <input name="days" type="number" autocomplete="off" pattern="[1-7]{1}" class="form-control inputMovie" id="days" required [(ngModel)]="rental.rentDays" #days="ngModel">
              <div *ngIf="days.errors && (days.dirty || days.touched)" class="alert alert-danger inputMovie">
                <div [hidden]="!days.errors.required">
                  Amount of days to rent is required.
                </div>
                <div [hidden]="!days.errors.pattern">
                  Company policy allows to rent VHS only for 1-7 days.
                </div>
              </div>
            </div>

            <button type="submit" (click)="rentVhs()" [disabled]="!rentForm.form.valid" class="btn btn-default">Submit</button>
          </form>
        </div>
        <div [hidden]="!rented">Movie {{currentMovie.title}} has been rented</div>
      </div>


      <div class="modal-footer">
        <button type="submit" [disabled]="rented" (click)="onSubmit(); onRent();" class="btn btn-default">Rent movie</button>
        <button type="button" (click)="clearAll(); rentForm.reset();" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>

  </div>
</div>

<div id="addMovie" style="margin-left:auto; margin-right:auto;" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        Add new movie
      </div>
      <div class="modal-body">
      <div [hidden]="submitted">
        <div class = "container-fluid">
          <h1>vhs form</h1>
          <form #movieForm="ngForm" (ngSubmit)="onSubmit()">

            <div class="form-group">
              <label for="title">Title</label>
              <input type="text" class ="form-control inputMovie" autocomplete="off" id="title" required minlength="3" maxlength="20" [(ngModel)]="newMovie.title" name="title" #title="ngModel">
              <div *ngIf="title.errors && (title.dirty || title.touched)" class="alert alert-danger inputMovie">
                <div [hidden]="!title.errors.required">
                  Title is required
                </div>
                <div [hidden]="!title.errors.minlength">
                  Title must contain min. 3 letters
                </div>
                <div [hidden]="!title.errors.maxlength">
                  Title cant contain more than 20 letters
                </div>
              </div>
            </div>

            <div class="form-group">
              <label for="director">Director</label>
              <input type="text" class ="form-control inputMovie" autocomplete="off" id="director" required minlength="3" maxlength="20" [(ngModel)]="newMovie.director" name="director" #director="ngModel">
              <div *ngIf="director.errors && (director.dirty || director.touched)" class="alert alert-danger inputMovie">
                <div [hidden]="!director.errors.required">
                  Director is required
                </div>
                <div [hidden]="!director.errors.minlength">
                  Director must contain min. 3 letters
                </div>
                <div [hidden]="!director.errors.maxlength">
                  Director cant contain more than 20 letters
                </div>
              </div>
            </div>

            <div class="form-group">
              <label for="genre">Genre</label>
              <select id="genre" class="form-control"
                      name="genre"
                      [(ngModel)]="newMovie.genre" required
                      #genre="ngModel" >
                <option *ngFor="let g of genres" [value]="g.genreName">{{g.genreName}}</option>
              </select>
              <div *ngIf="genre.errors && genre.touched" class="alert alert-danger">
                <div [hidden]="!genre.errors.required">Genre is required</div>
              </div>
            </div>

            <div class="form-group">
              <label for="year">Production year</label>
              <input name="year" type="number" autocomplete="off" pattern="[0-9]{4}" class="form-control inputMovie" id="year" required [(ngModel)]="newMovie.productionDate" #year="ngModel">
              <div *ngIf="year.errors && (year.dirty || year.touched)" class="alert alert-danger inputMovie">
                <div [hidden]="!year.errors.required">
                  Production year is required.
                </div>
                <div [hidden]="!year.errors.pattern">
                  Year must be in range between 1900-2050.
                </div>
              </div>
            </div>

            <div class="form-group">
              <label for="country">Production country</label>
              <input type="text" class ="form-control inputMovie" autocomplete="off" id="country" required minlength="3" maxlength="20" [(ngModel)]="newMovie.productionCountry" name="country" #country="ngModel">
              <div *ngIf="country.errors && (country.dirty || country.touched)" class="alert alert-danger inputMovie">
                <div [hidden]="!country.errors.required">
                  Production country is required
                </div>
                <div [hidden]="!country.errors.minlength">
                  Production country must contain min. 3 letters
                </div>
                <div [hidden]="!country.errors.maxlength">
                  Production country cant contain more than 20 letters
                </div>
              </div>
            </div>

            <div class="form-group">
              <label for="duration">Movie duration</label>
              <input name="duration" type="number" autocomplete="off" pattern="[0-9]{2,3}" class="form-control inputMovie" id="duration" required [(ngModel)]="newMovie.duration" #duration="ngModel">
              <div *ngIf="duration.errors && (duration.dirty || duration.touched)" class="alert alert-danger inputMovie">
                <div [hidden]="!duration.errors.required">
                  Movie duration is required.
                </div>
                <div [hidden]="!duration.errors.pattern">
                  Duration must be in range between 10-300 min.
                </div>
              </div>
            </div>

            <div class="form-group">
              <label for="poster">Poster url</label>
              <input type="text" class ="form-control inputMovie" autocomplete="off" id="poster" pattern="https?://.+"[(ngModel)]="newMovie.posterUrl" name="poster" #poster="ngModel">
              <div *ngIf="poster.errors && (poster.dirty || poster.touched)" class="alert alert-danger inputMovie">
                <div [hidden]="!poster.errors.pattern">
                  Must be a valid url
                </div>
              </div>
            </div>

            <button type="submit" (click)="createNewMovie()" [disabled]="!movieForm.form.valid" class="btn btn-default">Submit</button>
          </form>
        </div>
      </div>
      <div [hidden]="!submitted">stworzono/1!!!</div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" (click)="clearAll(); movieForm.reset();" data-dismiss="modal">Close</button>
      </div>
    </div>

  </div>
</div>

<div id="movieEdit" style="margin-left:auto; margin-right:auto;" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        Edit movie
      </div>
      <div class="modal-body">
        <div [hidden]="submitted">
          <div class = "container-fluid">
            <h1>Vhs edition form</h1>
            <form #movieEdit="ngForm" (ngSubmit)="onSubmit()">

              <div class="form-group">
                <label for="titleEdit">Title</label>
                <input type="text" class ="form-control inputMovie" autocomplete="off" id="titleEdit" required minlength="3" maxlength="20" [(ngModel)]="currentMovie.title" name="titleEdit" #titleEdit="ngModel">
                <div *ngIf="titleEdit.errors && (titleEdit.dirty || titleEdit.touched)" class="alert alert-danger inputMovie">
                  <div [hidden]="!titleEdit.errors.required">
                    Title is required
                  </div>
                  <div [hidden]="!titleEdit.errors.minlength">
                    Title must contain min. 3 letters
                  </div>
                  <div [hidden]="!titleEdit.errors.maxlength">
                    Title cant contain more than 20 letters
                  </div>
                </div>
              </div>

              <div class="form-group">
                <label for="directorEdit">Director</label>
                <input type="text" class ="form-control inputMovie" autocomplete="off" id="directorEdit" required minlength="3" maxlength="20" [(ngModel)]="currentMovie.director" name="directorEdit" #directorEdit="ngModel">
                <div *ngIf="directorEdit.errors && (directorEdit.dirty || directorEdit.touched)" class="alert alert-danger inputMovie">
                  <div [hidden]="!directorEdit.errors.required">
                    Director is required
                  </div>
                  <div [hidden]="!directorEdit.errors.minlength">
                    Director must contain min. 3 letters
                  </div>
                  <div [hidden]="!directorEdit.errors.maxlength">
                    Director cant contain more than 20 letters
                  </div>
                </div>
              </div>

              <div class="form-group">
                <label for="genreEdit">Genre</label>
                <select id="genreEdit" class="form-control"
                        name="genreEdit"
                        value="currentMovie.genre"
                        [(ngModel)]="currentMovie.genre" required
                        #genreEdit="ngModel" >
                  <option *ngFor="let g of genres" [value]="g.genreName">{{g.genreName}}</option>
                </select>
                <div *ngIf="genreEdit.errors && genreEdit.touched" class="alert alert-danger">
                  <div [hidden]="!genreEdit.errors.required">Genre is required</div>
                </div>
              </div>

              <div class="form-group">
                <label for="yearEdit">Production year</label>
                <input name="yearEdit" type="number" autocomplete="off" pattern="[0-9]{4}" class="form-control inputMovie" id="yearEdit" required [(ngModel)]="currentMovie.productionDate" #yearEdit="ngModel">
                <div *ngIf="yearEdit.errors && (yearEdit.dirty || yearEdit.touched)" class="alert alert-danger inputMovie">
                  <div [hidden]="!yearEdit.errors.required">
                    Production year is required.
                  </div>
                  <div [hidden]="!yearEdit.errors.pattern">
                    Year must be in range between 1900-2050.
                  </div>
                </div>
              </div>

              <div class="form-group">
                <label for="countryEdit">Production country</label>
                <input type="text" class ="form-control inputMovie" autocomplete="off" id="countryEdit" required minlength="3" maxlength="20" [(ngModel)]="currentMovie.productionCountry" name="countryEdit" #countryEdit="ngModel">
                <div *ngIf="countryEdit.errors && (countryEdit.dirty || countryEdit.touched)" class="alert alert-danger inputMovie">
                  <div [hidden]="!countryEdit.errors.required">
                    Production country is required
                  </div>
                  <div [hidden]="!countryEdit.errors.minlength">
                    Production country must contain min. 3 letters
                  </div>
                  <div [hidden]="!countryEdit.errors.maxlength">
                    Production country cant contain more than 20 letters
                  </div>
                </div>
              </div>

              <div class="form-group">
                <label for="durationEdit">Movie duration</label>
                <input name="durationEdit" type="number" autocomplete="off" pattern="[0-9]{2,3}" class="form-control inputMovie" id="durationEdit" required [(ngModel)]="currentMovie.duration" #durationEdit="ngModel">
                <div *ngIf="durationEdit.errors && (durationEdit.dirty || durationEdit.touched)" class="alert alert-danger inputMovie">
                  <div [hidden]="!durationEdit.errors.required">
                    Movie duration is required.
                  </div>
                  <div [hidden]="!durationEdit.errors.pattern">
                    Duration must be in range between 10-300 min.
                  </div>
                </div>
              </div>

              <div class="form-group">
                <label for="posterEdit">Poster url</label>
                <input type="text" class ="form-control inputMovie" autocomplete="off" id="posterEdit" pattern="https?://.+"[(ngModel)]="currentMovie.posterUrl" name="posterEdit" #posterEdit="ngModel">
                <div *ngIf="posterEdit.errors && (posterEdit.dirty || posterEdit.touched)" class="alert alert-danger inputMovie">
                  <div [hidden]="!posterEdit.errors.pattern">
                    Must be a valid url
                  </div>
                </div>
              </div>

              <button type="submit" (click)="editMovie()" [disabled]="!movieEdit.form.valid" class="btn btn-default">Edit</button>
            </form>
          </div>
        </div>
        <div [hidden]="!edited">Zedytowano informacje o filmie: {{currentMovie.title}}!</div>
        <div [hidden]="!deleted">Film zostal usuniety</div>
      </div>
      <div class="modal-footer">
        Check if you want to delete this movie
        <input type="checkbox" [(ngModel)]="deleteConfirmation">
        <button type="submit" (click)="deleteMovie(); confirmDeletion(); onSubmit();" [disabled]="!deleteConfirmation" class="btn btn-default">Delete</button>
        <button type="button" (click)="clearAll()" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>

  </div>
</div>
